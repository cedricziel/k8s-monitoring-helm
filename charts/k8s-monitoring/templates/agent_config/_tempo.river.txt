{{ define "agent.config.tempo" }}
// Tempo
remote.kubernetes.secret "tempo_credentials" {
  name = {{ include "kubernetes-monitoring.tempo.secretname" . | quote}}
  namespace = {{ .Values.externalServices.tempo.secret.namespace | default .Release.Namespace | quote}}
}
{{- with .Values.externalServices.tempo }}
{{ if .basicAuth }}
otelcol.auth.basic "tempo" {
  {{ if .basicAuth.username }}username = nonsensitive(remote.kubernetes.secret.tempo_credentials.data["{{ .basicAuth.usernameKey }}"]){{ end }}
  {{ if .basicAuth.password }}password = remote.kubernetes.secret.tempo_credentials.data["{{ .basicAuth.passwordKey }}"]{{ end }}
}
{{- end }}

otelcol.exporter.otlp "tempo" {
  client {
    endpoint = nonsensitive(remote.kubernetes.secret.tempo_credentials.data["{{ .hostKey }}"])
{{ if .basicAuth }}
    auth = otelcol.auth.basic.tempo.handler
{{- end }}
  }
}
{{- end }}
{{ end }}
